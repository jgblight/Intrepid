{% extends "map_base.html" %}

{% block script_functions %}
function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function (e) {
                var photo = $('#trip-image'); 
                photo.attr('src', e.target.result);
                photo.dragncrop('destroy');
                photo.dragncrop({ 
                    centered : true ,
                    instruction : true ,
                    stop: function(e,pos) {
                      $("#id_image_x").val(pos.dimension[0]);
                      $("#id_image_y").val(pos.dimension[1]);
                    }                       
                 });
                photo.imagesLoaded().done(function(){
                  var pos = photo.dragncrop("getPosition");
                  $("#id_image_x").val(pos.dimension[0]);
                  $("#id_image_y").val(pos.dimension[1]);
                  
                }); 
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }
{% endblock %}

{% block initialize_script %}

    $("#id_image").change(function(){
      readURL(this);
    });
    $('#trip-image').dragncrop();

{% endblock %}

{% block content %}
{% load bootstrap %}
<div id="trip-image-div" class="show-trip-image"> <img id="trip-image" src="http://placekitten.com/500/300" /></div> 
<div id="trip-pane" class="show-trip-pane">
<form action="/trip/new" method="post">{% csrf_token %}
{{ form|bootstrap }}
<input type="submit" class="btn btn-default" value="Create" />
</div>
{% endblock %}